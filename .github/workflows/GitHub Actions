name: Build and Deploy Node.js Application to Azure Web App

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Ø®Ø·ÙˆØ© 1: Checkout Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: Checkout code
        uses: actions/checkout@v4

      # Ø®Ø·ÙˆØ© 2: Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Node.js
      - name: Set up Node.js version
        uses: actions/setup-node@v4
        with:
          node-version: "18.x"  # Ø§Ø®ØªØ± Ø¥ØµØ¯Ø§Ø± Node.js Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬Ù‡

      # Ø®Ø·ÙˆØ© 3: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      - name: Install dependencies, build, and test
        run: |
          npm install       # ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
          npm run build     # Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          npm run test      # Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©)

      # Ø®Ø·ÙˆØ© 4: Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„ØªØ¬Ù‡ÙŠØ² Ù„Ù„Ù†Ø´Ø±
      - name: Zip artifact for deployment
        run: zip -r deployment.zip ./dist ./public  # Ø£Ùˆ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù†Ø´Ø±Ù‡Ø§

      # Ø®Ø·ÙˆØ© 5: Ø±ÙØ¹ Ø§Ù„Ø£Ø±ØªÙŠÙÙƒØª Ù„Ù„Ù†Ø´Ø±
      - name: Upload artifact for deployment job
        uses: actions/upload-artifact@v4
        with:
          name: node-app
          path: deployment.zip

  deploy:
    runs-on: ubuntu-latest
    needs: build  # Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø³ØªÙ†ÙØ° Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©

    steps:
      # Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±ØªÙŠÙÙƒØª Ù…Ù† Ø®Ø·ÙˆØ© Ø§Ù„Ø¨Ù†Ø§Ø¡
      - name: Download artifact for deployment
        uses: actions/download-artifact@v4
        with:
          name: node-app

      # Ø®Ø·ÙˆØ© 2: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Azure
- name: ğŸ—ï¸ Azure Login
  uses: azure/login@v1
  with:
    client-id: ${{ secrets.AZURE_CLIENT_ID }}
    client-secret: ${{ secrets.AZURE_CLIENT_SECRET }}
    tenant-id: ${{ secrets.AZURE_TENANT_ID }}
    subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}


      # Ø®Ø·ÙˆØ© 3: Ù†Ø´Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù„Ù‰ Azure Web
